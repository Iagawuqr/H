--[[
ESP Script with Red Boxes, Name ESP, Toggle Button, and Open/Close GUI
Tested for Roblox Lua (LocalScript). Place this in StarterPlayerScripts for best results.
--]]

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- Variables
local localPlayer = Players.LocalPlayer
local espEnabled = false
local nameEspEnabled = false
local guiOpen = true
local espDrawings = {}

-- Functions to manage ESP
local function createESPForCharacter(character)
    if not character then return end
    local head = character:FindFirstChild("Head")
    if not head then return end

    -- BillboardGui for ESP (red frame)
    local bb = Instance.new("BillboardGui")
    bb.Name = "RedESP"
    bb.Adornee = head
    bb.Size = UDim2.new(4,0,5,0)
    bb.AlwaysOnTop = true
    bb.StudsOffset = Vector3.new(0, 1.5, 0)

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1,0,1,0)
    frame.BackgroundTransparency = 1
    frame.BorderSizePixel = 0

    local redOutline = Instance.new("UIStroke")
    redOutline.Thickness = 4
    redOutline.Color = Color3.new(1,0,0)
    redOutline.Parent = frame

    frame.Parent = bb

    -- Name ESP
    if nameEspEnabled then
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(1,0,0,24)
        nameLabel.Position = UDim2.new(0,0,0,-24)
        nameLabel.BackgroundTransparency = 1
        nameLabel.TextColor3 = Color3.new(1, 0, 0)
        nameLabel.TextStrokeTransparency = 0.5
        nameLabel.TextScaled = true
        nameLabel.Text = character.Name
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.Parent = bb
    end

    bb.Parent = CoreGui
    return bb
end

local function removeAllESP
