--// Configurações
local aimbotAtivo = false
local espAtivo = false

--// Função de Team Check
local function isEnemy(player)
    local localPlayer = game.Players.LocalPlayer
    if not player.Team or not localPlayer.Team then return false end
    return player.Team ~= localPlayer.Team
end

--// Função de ESP
local function criarESP(player)
    if not player.Character then return end
    local head = player.Character:FindFirstChild("Head")
    if not head then return end

    if not head:FindFirstChild("EspBox") then
        local box = Instance.new("BillboardGui")
        box.Name = "EspBox"
        box.Size = UDim2.new(4,0,4,0)
        box.Adornee = head
        box.AlwaysOnTop = true
        box.Parent = head

        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1,0,1,0)
        frame.BackgroundColor3 = Color3.new(1,0,0)
        frame.BackgroundTransparency = 0.5
        frame.BorderSizePixel = 0
        frame.Parent = box
    end
end

local function removerESP(player)
    if not player.Character then return end
    local head = player.Character:FindFirstChild("Head")
    if not head then return end
    local box = head:FindFirstChild("EspBox")
    if box then
        box:Destroy()
    end
end

--// ESP Loop
game:GetService("RunService").RenderStepped:Connect(function()
    if espAtivo then
        for _,player in ipairs(game.Players:GetPlayers()) do
            if player ~= game.Players.LocalPlayer and isEnemy(player) then
                criarESP(player)
            else
                removerESP(player)
            end
        end
    else
        for _,player in ipairs(game.Players:GetPlayers()) do
            removerESP(player)
        end
    end
end)

--// Função de Aimbot
local uis = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

local function getClosestEnemy()
    local closestPlayer = nil
    local shortestDistance = math.huge
    local mousePos = uis:GetMouseLocation()

    for _,player in ipairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer and isEnemy(player) and player.Character and player.Character:FindFirstChild("Head") then
            local pos, onScreen = camera:WorldToViewportPoint(player.Character.Head.Position)
            if onScreen then
                local distance = (Vector2.new(pos.X, pos.Y) - Vector2.new(mousePos.X, mousePos.Y)).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

uis.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton2 and aimbotAtivo then -- Botão direito do mouse
        local target = getClosestEnemy()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            camera.CFrame = CFrame.new(camera.CFrame.Position, target.Character.Head.Position)
        end
    end
end)

--// ScreenGui
local player = game.Players.LocalPlayer
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AimbotESP_GUI"
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 150)
frame.Position = UDim2.new(0.05, 0, 0.25, 0)
frame.BackgroundTransparency = 0.2
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Visible = false
frame.Parent = screenGui

local aimbotBtn = Instance.new("TextButton")
aimbotBtn.Size = UDim2.new(1, -20, 0, 40)
aimbotBtn.Position = UDim2.new(0, 10, 0, 10)
aimbotBtn.Text = "Aimbot: OFF"
aimbotBtn.BackgroundTransparency = 0.1
aimbotBtn.Parent = frame

local espBtn = Instance.new("TextButton")
espBtn.Size = UDim2.new(1, -20, 0, 40)
espBtn.Position = UDim2.new(0, 10, 0, 60)
espBtn.Text = "ESP: OFF"
espBtn.BackgroundTransparency = 0.1
espBtn.Parent = frame

local fecharBtn = Instance.new("TextButton")
fecharBtn.Size = UDim2.new(1, -20, 0, 30)
fecharBtn.Position = UDim2.new(0, 10, 0, 110)
fecharBtn.Text = "Fechar"
fecharBtn.BackgroundTransparency = 0.1
fecharBtn.Parent = frame

local abrirBtn = Instance.new("TextButton")
abrirBtn.Size = UDim2.new(0, 80, 0, 30)
abrirBtn.Position = UDim2.new(0.01, 0, 0.2, 0)
abrirBtn.Text = "Abrir Menu"
abrirBtn.Parent = screenGui

abrirBtn.MouseButton1Click:Connect(function()
    frame.Visible = true
    abrirBtn.Visible = false
end)
fecharBtn.MouseButton1Click:Connect(function()
    frame.Visible = false
    abrirBtn.Visible = true
end)

aimbotBtn.MouseButton1Click:Connect(function()
    aimbotAtivo = not aimbotAtivo
    aimbotBtn.Text = "Aimbot: " .. (aimbotAtivo and "ON" or "OFF")
end)

espBtn.MouseButton1Click:Connect(function()
    espAtivo = not espAtivo
    espBtn.Text = "ESP: " .. (espAtivo and "ON" or "OFF")
end)
