local player = game.Players.LocalPlayer
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "PosMarkerGui"

local markBtn = Instance.new("TextButton", gui)
markBtn.Size = UDim2.new(0, 150, 0, 50)
markBtn.Position = UDim2.new(0, 20, 0, 100)
markBtn.Text = "Marcar Posição"

local goBtn = Instance.new("TextButton", gui)
goBtn.Size = UDim2.new(0, 150, 0, 50)
goBtn.Position = UDim2.new(0, 20, 0, 160)
goBtn.Text = "Ir para Posição"

local savedCFrame = nil
local isFlying = false

markBtn.MouseButton1Click:Connect(function()
    local char = player.Character or player.CharacterAdded:Wait()
    if char and char:FindFirstChild("HumanoidRootPart") then
        savedCFrame = char.HumanoidRootPart.CFrame
        markBtn.Text = "Posição Marcada!"
        wait(1)
        markBtn.Text = "Marcar Posição"
    end
end)

goBtn.MouseButton1Click:Connect(function()
    if isFlying then return end
    local char = player.Character or player.CharacterAdded:Wait()
    if savedCFrame and char and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChild("Humanoid") then
        isFlying = true
        local hrp = char.HumanoidRootPart
        local humanoid = char.Humanoid
        local startCFrame = hrp.CFrame
        local endCFrame = savedCFrame
        local distance = (startCFrame.Position - endCFrame.Position).magnitude
        local duration = math.clamp(distance / 10, 0.5, 5)

        local elapsed = 0
        local runService = game:GetService("RunService")

        -- Protege o personagem de morrer durante o voo
        hrp.Anchored = true
        humanoid.PlatformStand = true  -- impede animações/quedas/desmaios

        -- Opcional: desativa colisão do HRP (ou de todos os parts do personagem)
        for _, part in ipairs(char:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end

        local conn
        conn = runService.RenderStepped:Connect(function(dt)
            elapsed = elapsed + dt
            local alpha = math.clamp(elapsed / duration, 0, 1)
            local newCFrame = startCFrame:Lerp(endCFrame, alpha)
            hrp.CFrame = newCFrame
            if alpha >= 1 then
                conn:Disconnect()
                hrp.CFrame = endCFrame
                hrp.Anchored = false
                humanoid.PlatformStand = false -- volta ao normal

                -- Ativa colisão novamente
                for _, part in ipairs(char:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
                isFlying = false
            end
        end)
    end
end)
